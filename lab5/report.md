# Лабораторна робота №5 (Номалізація)

### 1. Аналіз поточної схеми та виявлення аномалій

В ході аналізу DDL схеми Лаборатоної робота №2 було розглянуто таблицю `addresses`, яка зберігає дані про доставку для користувачів.

**Виявлені проблеми:**
1.  **Порушення 1NF (Атомарність):** Поле `street_line` у таблиці `addresses` містить комбіновані дані ("Вулиця, будинок, квартира"). Це ускладнює пошук, фільтрацію та валідацію конкретних номерів будинків.
2.  **Порушення 3NF (Транзитивна залежність):** Існує залежність між поштовим індексом (`zip_code`) та містом/країною (`city`, `country`). У поточній схемі, якщо ми маємо 1000 користувачів з Києва (індекс 01001), ми 1000 разів дублюємо текстові значення 'Ukraine' та 'Kyiv'. Атрибути `country` та `city` залежать від `zip_code` (або сутності "Населений пункт"), а не безпосередньо від ідентифікатора адреси.
3.  **Дублювання у `shipments`:** Таблиця `shipments` копіює структуру адреси текстом. Хоча це вимога бізнес-логіки (snapshot), структуру полів варто привести у відповідність до нормалізованої таблиці `addresses`.

### 2. Функціональні залежності

**Таблиця addresses (Проблемна):**
1.  `id` -> `user_id`, `street_line`, `zip_code`, `city`, `country` (Первинний ключ визначає все).
2.  `zip_code` -> `city`, `country` (Транзитивна залежність: Індекс/Місто визначають країну, а не конкретна адреса користувача)

### 3. Процес нормалізації

#### Крок 1: Оцінка 1NF (Атомарність)
* **Проблема:** Атрибут `street_line` не є атомарним
* **Рішення:** Розбити `street_line` на три окремі поля: `street` (вулиця), `building_number` (номер будинку), `apartment_number` (номер квартири/офісу).
* **Результат:** Таблиця переходить у 1NF

#### Крок 2: Оцінка 2NF (Часткові залежності)
* **Статус:** Первинний ключ `addresses` є простим (`id`). Часткових залежностей від частини ключа немає. Таблиця автоматично в 2NF.

#### Крок 3: Оцінка 3NF (Транзитивні залежності)
* **Проблема:** Атрибути `country` та `city` залежать від сутності "Місто/Населений пункт".
* **Рішення:** Декомпозиція. Виносимо довідник міст в окрему таблицю `cities`
    * Створюємо таблицю `cities` (`id`, `country`, `name`, `zip_code`*).
    * У таблиці `addresses` замість текстових полів `country` та `city` залишаємо посилання `city_id`.
    * *Примітка:* Оскільки один індекс може покривати кілька вулиць, або одне місто мати багато індексів, для спрощення моделі в рамках лабораторної ми прив'язуємо адресу до `city_id`, а `zip_code` залишаємо в адресі (як уточнення) або в місті, якщо воно мале. У цій реалізації ми створимо довідник `settlements` (населених пунктів).

### 4. Перероблений дизайн (Декомпозиція)

**Зміни в схемі:**

1.  **Нова таблиця `settlements`**:
    * `id` (PK)
    * `country`
    * `city`
    * `default_zip_code` (опціонально)

2.  **Оновлена таблиця `addresses`**:
    * Видалено: `country`, `city` (текстові), `street_line`.
    * Додано: `settlement_id` (FK), `street`, `building`, `apartment`.

3.  **Оновлена таблиця `shipments`**:
    * Поля синхронізовано з новою структурою адреси (розбито `street_line` на частини), щоб зберігати точний історичний знімок у тому ж форматі.